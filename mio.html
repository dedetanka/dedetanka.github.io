<script>
  const tankaElement = document.getElementById("tanka");
  const randomIndex = Math.floor(Math.random() * tankas.length);
  tankaElement.innerHTML = tankas[randomIndex];

  function scrollToTopAndReload() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
    location.reload();
  }

  function speakTanka() {
    // <ruby>の中にふりがな（rt）がある場合はそれだけを抽出
    const rubies = tankaElement.querySelectorAll("ruby");
    rubies.forEach(ruby => {
      const rt = ruby.querySelector("rt");
      if (rt) {
        ruby.replaceWith(document.createTextNode(rt.textContent));
      } else {
        ruby.replaceWith(document.createTextNode(ruby.textContent));
      }
    });

    const text = tankaElement.innerText.replace(/\s+/g, ' ').trim();
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = 'ja-JP';
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
  }
</script>
